{% extends "base.html" %}

{% block title %}Analysis Results - Sentiment Analysis App{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-chart-line"></i> Analysis Results</h1>
            <a href="{{ url_for('index') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Analyze New Text
            </a>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-success">
            <h5><i class="fas fa-check-circle"></i> Analysis Complete!</h5>
            <p class="mb-0">Your text has been successfully analyzed. Here are the detailed results:</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- Text Display -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100 shadow">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-file-text"></i> Analyzed Text</h5>
            </div>
            <div class="card-body">
                <div class="border p-3 rounded bg-light" style="max-height: 300px; overflow-y: auto;">
                    <p class="mb-0">{{ analysis.text }}</p>
                </div>
                
                <div class="row mt-3">
                    <div class="col-6">
                        <small class="text-muted">
                            <i class="fas fa-clock"></i> Analyzed: {{ analysis.timestamp[:19] }}
                        </small>
                    </div>
                    <div class="col-6 text-end">
                        <small class="text-muted">
                            <i class="fas fa-language"></i> Language: {{ analysis.detected_language.upper() }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Results Summary -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100 shadow">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-poll"></i> Sentiment Summary</h5>
            </div>
            <div class="card-body">
                <div class="row text-center mb-3">
                    <div class="col-12">
                        <h2 class="sentiment-{{ analysis.sentiment.lower() }} p-3 rounded">
                            <i class="fas fa-{{ 'smile' if analysis.sentiment == 'Positive' else 'frown' if analysis.sentiment == 'Negative' else 'meh' }}"></i>
                            {{ analysis.sentiment }}
                        </h2>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h4 class="text-primary">{{ analysis.polarity }}</h4>
                                <small>Polarity Score</small>
                                <br>
                                <small class="text-muted">(-1 to +1)</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h4 class="text-info">{{ analysis.subjectivity }}</h4>
                                <small>Subjectivity</small>
                                <br>
                                <small class="text-muted">(0 to 1)</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="text-center">
                            <span class="badge confidence-{{ analysis.confidence.lower() }} text-dark fs-6 p-2">
                                <i class="fas fa-certificate"></i> {{ analysis.confidence }} Confidence
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Text Statistics -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Text Statistics</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <h3 class="text-primary">{{ analysis.word_count }}</h3>
                        <small>Words</small>
                    </div>
                    <div class="col-4">
                        <h3 class="text-success">{{ analysis.sentence_count }}</h3>
                        <small>Sentences</small>
                    </div>
                    <div class="col-4">
                        <h3 class="text-info">{{ (analysis.text|length) }}</h3>
                        <small>Characters</small>
                    </div>
                </div>
                
                {% if analysis.word_count > 0 %}
                <div class="mt-3">
                    <small class="text-muted">
                        Average words per sentence: {{ "%.1f"|format(analysis.word_count / analysis.sentence_count) }}
                    </small>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Key Phrases -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-key"></i> Key Phrases</h5>
            </div>
            <div class="card-body">
                {% if analysis.key_phrases %}
                    <div class="d-flex flex-wrap gap-2">
                        {% for phrase in analysis.key_phrases %}
                            <span class="badge bg-light text-dark border">{{ phrase }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted mb-0">
                        <i class="fas fa-info-circle"></i> No significant key phrases detected.
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if chart_url %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Visual Analysis</h5>
            </div>
            <div class="card-body text-center">
                <div class="chart-container">
                    <img src="data:image/png;base64,{{ chart_url }}" class="img-fluid" alt="Sentiment Analysis Chart">
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Understanding Your Results</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><strong>Polarity Score ({{ analysis.polarity }}):</strong></h6>
                        <p class="small">
                            {% if analysis.polarity > 0.5 %}
                                Very positive sentiment - the text expresses strong positive emotions.
                            {% elif analysis.polarity > 0.1 %}
                                Positive sentiment - the text leans toward positive emotions.
                            {% elif analysis.polarity > -0.1 %}
                                Neutral sentiment - the text is neither positive nor negative.
                            {% elif analysis.polarity > -0.5 %}
                                Negative sentiment - the text leans toward negative emotions.
                            {% else %}
                                Very negative sentiment - the text expresses strong negative emotions.
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6><strong>Subjectivity Score ({{ analysis.subjectivity }}):</strong></h6>
                        <p class="small">
                            {% if analysis.subjectivity > 0.7 %}
                                Highly subjective - contains personal opinions and emotions.
                            {% elif analysis.subjectivity > 0.3 %}
                                Moderately subjective - mix of facts and opinions.
                            {% else %}
                                Objective - mostly factual information with little personal opinion.
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 text-center">
        <div class="btn-group" role="group">
            <a href="{{ url_for('index') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Analyze Another Text
            </a>
            <a href="{{ url_for('history') }}" class="btn btn-info">
                <i class="fas fa-history"></i> View History
            </a>
            <a href="{{ url_for('batch_analysis') }}" class="btn btn-success">
                <i class="fas fa-upload"></i> Batch Analysis
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add copy to clipboard functionality
    const textContent = document.querySelector('.border.p-3.rounded.bg-light p');
    if (textContent) {
        const copyButton = document.createElement('button');
        copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy Text';
        copyButton.className = 'btn btn-sm btn-outline-secondary mt-2';
        copyButton.onclick = function() {
            navigator.clipboard.writeText(textContent.textContent).then(function() {
                copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                copyButton.className = 'btn btn-sm btn-success mt-2';
                setTimeout(function() {
                    copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy Text';
                    copyButton.className = 'btn btn-sm btn-outline-secondary mt-2';
                }, 2000);
            });
        };
        textContent.parentElement.appendChild(copyButton);
    }
});
</script>
{% endblock %}